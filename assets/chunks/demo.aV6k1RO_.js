import{d as _,p as v,D as A,v as P,P as D,$ as B,o as F,b as I,w as M,j as l,k as h,N as w,a as R,au as N,a8 as H,av as U}from"./framework.BSn6qPJ2.js";import{d as g,_ as W}from"./cesium-view.vue_vue_type_script_setup_true_lang.CTi6Dcl_.js";import*as e from"/GJ/cesiumStatic/index.js";import"./theme.DCUEEecw.js";class k{constructor(t){this.commandType=t.commandType,this.modelMatrix=t.modelMatrix,this.geometry=t.geometry,this.attributeLocations=t.attributeLocations,this.primitiveType=t.primitiveType,this.uniformMap=t.uniformMap,this.vertexShaderSource=t.vertexShaderSource,this.fragmentShaderSource=t.fragmentShaderSource,this.rawRenderState=t.rawRenderState,this.framebuffer=t.framebuffer,this.outputTexture=t.outputTexture,this.autoClear=e.defaultValue(t.autoClear,!1),this.preExecute=t.preExecute,this.show=!0,this.commandToExecute=void 0,this.clearCommand=void 0,this.autoClear&&(this.clearCommand=new e.ClearCommand({color:new e.Color(0,0,0,0),depth:1,framebuffer:this.framebuffer,pass:e.Pass.OPAQUE}))}createCommand(t){switch(this.commandType){case"Draw":{var s=e.VertexArray.fromGeometry({context:t,geometry:this.geometry,attributeLocations:this.attributeLocations,bufferUsage:e.BufferUsage.STATIC_DRAW}),c=e.ShaderProgram.fromCache({context:t,attributeLocations:this.attributeLocations,vertexShaderSource:this.vertexShaderSource,fragmentShaderSource:this.fragmentShaderSource}),p=e.RenderState.fromCache(this.rawRenderState);return new e.DrawCommand({owner:this,vertexArray:s,primitiveType:this.primitiveType,uniformMap:this.uniformMap,modelMatrix:this.modelMatrix||e.Matrix4.IDENTITY,shaderProgram:c,framebuffer:this.framebuffer,renderState:p,pass:e.Pass.OPAQUE})}case"Compute":return new e.ComputeCommand({owner:this,fragmentShaderSource:this.fragmentShaderSource,uniformMap:this.uniformMap,outputTexture:this.outputTexture,persists:!0})}}setGeometry(t,s){this.geometry=s;var c=e.VertexArray.fromGeometry({context:t,geometry:this.geometry,attributeLocations:this.attributeLocations,bufferUsage:e.BufferUsage.STATIC_DRAW});this.commandToExecute.vertexArray=c}update(t){this.show&&(e.defined(this.commandToExecute)||(this.commandToExecute=this.createCommand(t.context)),e.defined(this.preExecute)&&this.preExecute(),e.defined(this.clearCommand)&&t.commandList.push(this.clearCommand),this.framebuffer,t.commandList.push(this.commandToExecute))}isDestroyed(){return!1}destroy(){return e.defined(this.commandToExecute)&&(this.commandToExecute.shaderProgram=this.commandToExecute.shaderProgram&&this.commandToExecute.shaderProgram.destroy()),e.destroyObject(this)}}const G={class:""},V={class:"my-4 flex items-center gap-4"},z=["checked"],j=_({__name:"demo",setup(y){const t=v(!1),s=v("#c34921"),c=v(null);function p(r){const a=r.drawingBufferWidth,i=r.drawingBufferHeight,u=new e.Texture({context:r,width:a,height:i,flipY:!0,pixelFormat:e.PixelFormat.RGBA});return new e.Framebuffer({context:r,colorTextures:[u],depthTexture:new e.Texture({context:r,width:a,height:i,pixelFormat:e.PixelFormat.DEPTH_COMPONENT,pixelDatatype:e.PixelDatatype.UNSIGNED_SHORT})})}const T=()=>new e.Geometry({attributes:{position:new e.GeometryAttribute({componentDatatype:e.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}),st:new e.GeometryAttribute({componentDatatype:e.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array([0,0,1,0,1,1,0,1])}),normal:void 0,bitangent:void 0,color:void 0,tangent:void 0},indices:new Uint32Array([3,2,0,0,2,1])});function S(r){const{scene:a,framebuffer:i,color:u}=r,n=a.context,d=a._defaultView,m=d.viewport;m.x=0,m.y=0,m.width=n.drawingBufferWidth,m.height=n.drawingBufferHeight;const o=d.passState;o.framebuffer=i,o.blendingEnabled=void 0,o.scissorTest=void 0,o.viewport=e.BoundingRectangle.clone(m,o.viewport),n.clear({framebuffer:i,color:u,depth:1,stencil:0,clearColor:!0,clearDepth:!0,clearStencil:!1});const f=new k({commandType:"Draw",geometry:T(),uniformMap:{myColor(){return e.Color.GREEN}},primitiveType:e.PrimitiveType.TRIANGLES,attributeLocations:{position:0,st:1},vertexShaderSource:new e.ShaderSource({defines:["DISABLE_GL_POSITION_LOG_DEPTH"],sources:[`
        in vec3 position;
        in vec2 st;

        out vec2 textureCoordinate;

        void main() {
            textureCoordinate = st;
            gl_Position = vec4(position, 1.0);
        }
        `]}),fragmentShaderSource:new e.ShaderSource({sources:[`
          in vec2 textureCoordinate;
          uniform vec3 myColor;

          void main()
          {

              out_FragColor = vec4(textureCoordinate, 1.0, 1.0);
          }
        `]}),framebuffer:i});return a.primitives.add(f),console.log("%c comPrimitive: ","background-color: #3756d4; padding: 4px 8px; border-radius: 2px; font-size: 14px; color: #fff; font-weight: 700;",f),a.updateFrameState(),a.resolveFramebuffers(o),o.framebuffer=void 0,n.endFrame()}const C=A({fbo:null});P(()=>{const r=g.value,a=r.scene.context;C.value.fbo=p(a),E(r),D(()=>{c.value&&x()})});const x=()=>{const r=g.value,a=r.scene.context,i=C.value.fbo;S({framebuffer:i,scene:r.scene,color:e.Color.fromCssColorString(s.value)});let u=a.drawingBufferWidth,n=a.drawingBufferHeight;const d=c.value;d.width=u,d.height=n;const m=a.readPixels({x:0,y:0,width:u,height:n,framebuffer:i}),o=d.getContext("2d",{willReadFrequently:!0}),f=new Uint8ClampedArray(m);let O=new ImageData(f,u,n);o.putImageData(O,0,0,0,0,u,n),o.translate(0,n),o.scale(1,-1),o.drawImage(d,0,0)},b=()=>{x()};function L(){const r=g.value;t.value=!t.value,t.value?r.scene.preRender.addEventListener(b):r.scene.preRender.removeEventListener(b)}B(()=>{});const E=r=>{r.scene.primitives.add(new e.DebugModelMatrixPrimitive({length:1e7})),r.entities.add({position:new e.Cartesian3(1e7,0,0),label:{text:"X轴",font:"18px Helvetica",fillColor:e.Color.WHITE,outlineColor:e.Color.BLACK,outlineWidth:2,style:e.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.BOTTOM,pixelOffset:new e.Cartesian2(15,-15)}}),r.entities.add({position:new e.Cartesian3(0,1e7,0),label:{text:"Y轴",font:"18px Helvetica",fillColor:e.Color.WHITE,outlineColor:e.Color.BLACK,outlineWidth:2,style:e.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.BOTTOM,pixelOffset:new e.Cartesian2(15,-15)}}),r.entities.add({position:new e.Cartesian3(0,0,1e7),label:{text:"Z轴",font:"18px Helvetica",fillColor:e.Color.WHITE,outlineColor:e.Color.BLACK,outlineWidth:2,style:e.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.BOTTOM,pixelOffset:new e.Cartesian2(15,-15)}})};return(r,a)=>(F(),I(W,null,{default:M(()=>[l("div",G,[l("div",V,[l("div",{class:"da-btn da-btn-accent da-btn-sm",onClick:x},"更新离屏渲染"),a[2]||(a[2]=l("div",{class:"da-label-text"},"在prerender帧中更新:",-1)),l("input",{type:"checkbox",class:"da-toggle da-toggle-accent border border-solid border-slate-600",checked:h(t),onChange:L},null,40,z),l("div",{class:"da-label-text flex items-center",style:w({color:h(s)})},[a[1]||(a[1]=R(" 输入颜色： ")),l("span",{class:"inline-block size-4",style:w({backgroundColor:h(s)})},null,4)],4),N(l("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=i=>H(s)?s.value=i:null),placeholder:"输入颜色",class:"da-input da-input-xs da-input-bordered da-input-primary max-w-xs border border-solid"},null,512),[[U,h(s)]])]),l("canvas",{ref_key:"offCanvas",ref:c},null,512)])]),_:1}))}});export{j as default};
