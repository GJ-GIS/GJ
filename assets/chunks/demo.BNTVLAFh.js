import{d as m,_ as O}from"./cesium-view.vue_vue_type_script_setup_true_lang.DB8O3Ft0.js";import*as t from"/GJ/cesiumStatic/index.js";import{d as T,p as v,D as B,v as F,P as y,$ as E,o as M,b as S,w as k,j as u,k as A}from"./framework.BSn6qPJ2.js";import"./theme.Bcjxkfh6.js";const H={class:""},I={class:"my-4 flex items-center gap-4"},W=["checked"],z=T({__name:"demo",setup(P){const c=v(!1),g=v(null),p=B({fbo:null,fboTexture:null});function w(a){let e=a.drawingBufferWidth,o=a.drawingBufferHeight;return new t.Texture({context:a,width:e,height:o,pixelFormat:t.PixelFormat.RGBA})}function C(a,e){return new t.Framebuffer({context:a,colorTextures:[e],destroyAttachments:!1})}function x(a,e){const o=e._frameState,r=e.context,l=r.uniformState,s=e._defaultView;e._view=s,e.updateFrameState(),o.passes.render=!0,o.passes.postProcess=e.postProcessStages.hasSelected;let i=t.defaultValue(e.backgroundColor,t.Color.BLACK);e._hdr&&(i.red=Math.pow(i.red,e.gamma),i.green=Math.pow(i.green,e.gamma),i.blue=Math.pow(i.blue,e.gamma)),o.backgroundColor=i,o.atmosphere=e.atmosphere,e.fog.update(o),l.update(o);const d=e.shadowMap;t.defined(d)&&d.enabled&&(!t.defined(e.light)||e.light instanceof t.SunLight?t.Cartesian3.negate(l.sunDirectionWC,e._shadowMapCamera.direction):t.Cartesian3.clone(e.light.direction,e._shadowMapCamera.direction),o.shadowMaps.push(d)),e._computeCommandList.length=0,e._overlayCommandList.length=0;const f=s.viewport;f.x=0,f.y=0,f.width=r.drawingBufferWidth,f.height=r.drawingBufferHeight;const n=s.passState;n.framebuffer=a,n.blendingEnabled=void 0,n.scissorTest=void 0,n.viewport=t.BoundingRectangle.clone(f,n.viewport),t.defined(e.globe)&&e.globe.beginFrame(o),e.updateEnvironment(),e.updateAndExecuteCommands(n,i),e.resolveFramebuffers(n),n.framebuffer=void 0,t.defined(e.globe)&&(e.globe.endFrame(o),e.globe.tilesLoaded||(e._renderRequested=!0)),r.endFrame(),e.globe.show=!0}F(()=>{const a=m.value,e=a.scene.context,o=w(e),r=C(e,o);p.value.fbo=r,p.value.fboTexture=o,L(a),y(()=>{g.value&&h()})});const h=()=>{const a=m.value,e=a.scene.context,o=p.value.fbo;x(o,a.scene);let r=e.drawingBufferWidth,l=e.drawingBufferHeight;const s=g.value;s.width=r,s.height=l;const i=e.readPixels({x:0,y:0,width:r,height:l,framebuffer:o}),d=s.getContext("2d",{willReadFrequently:!0}),f=new Uint8ClampedArray(i);let n=new ImageData(f,r,l);d.putImageData(n,0,0,0,0,r,l),d.translate(0,l),d.scale(1,-1),d.drawImage(s,0,0)},b=()=>{h()};function _(){const a=m.value;c.value=!c.value,c.value?a.scene.preRender.addEventListener(b):a.scene.preRender.removeEventListener(b)}E(()=>{});const L=a=>{a.scene.primitives.add(new t.DebugModelMatrixPrimitive({length:1e7})),a.entities.add({position:new t.Cartesian3(1e7,0,0),label:{text:"X轴",font:"18px Helvetica",fillColor:t.Color.WHITE,outlineColor:t.Color.BLACK,outlineWidth:2,style:t.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:t.HorizontalOrigin.LEFT,verticalOrigin:t.VerticalOrigin.BOTTOM,pixelOffset:new t.Cartesian2(15,-15)}}),a.entities.add({position:new t.Cartesian3(0,1e7,0),label:{text:"Y轴",font:"18px Helvetica",fillColor:t.Color.WHITE,outlineColor:t.Color.BLACK,outlineWidth:2,style:t.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:t.HorizontalOrigin.LEFT,verticalOrigin:t.VerticalOrigin.BOTTOM,pixelOffset:new t.Cartesian2(15,-15)}}),a.entities.add({position:new t.Cartesian3(0,0,1e7),label:{text:"Z轴",font:"18px Helvetica",fillColor:t.Color.WHITE,outlineColor:t.Color.BLACK,outlineWidth:2,style:t.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:t.HorizontalOrigin.LEFT,verticalOrigin:t.VerticalOrigin.BOTTOM,pixelOffset:new t.Cartesian2(15,-15)}})};return(a,e)=>(M(),S(O,null,{default:k(()=>[u("div",H,[u("div",I,[u("div",{class:"da-btn da-btn-accent da-btn-sm",onClick:h},"更新离屏渲染"),e[0]||(e[0]=u("div",{class:"da-label-text"},"在prerender帧中更新:",-1)),u("input",{type:"checkbox",class:"da-toggle da-toggle-accent border border-solid border-slate-600",checked:A(c),onChange:_},null,40,W)]),u("canvas",{ref_key:"offCanvas",ref:g},null,512)])]),_:1}))}});export{z as default};
